app-id: com.alizadicomviewer.AlizaMS
runtime: org.kde.Platform
sdk: org.kde.Sdk
runtime-version: '5.15'
command: alizams
#For CastXML
sdk-extensions:
  - org.freedesktop.Sdk.Extension.llvm11
rename-desktop-file: alizams.desktop
rename-icon: alizams
finish-args:
  - --share=ipc
  - --socket=x11
  - --filesystem=home
cleanup:
  - /include
  - /lib/cmake
  - '*.la'
  - '*.a'
  - '/man'

modules:
    #cmake-ninja does not work
  - name: CastXML
    buildsystem: cmake
    config-opts:
      - -DCLANG_LINK_CLANG_DYLIB:BOOL=ON
      - -DLLVM_DIR=/usr/lib/sdk/llvm11/lib/cmake/llvm
    sources:
      - type: archive
        url: https://github.com/CastXML/CastXML/archive/v0.4.4.tar.gz
        sha256: e7343edf262b291a9a3d702dbfa6d660e8ed81170454eab6af10a6dbf8c8141d
        x-checker-data:
          type: anitya
          project-id: 9347
          stable-only: true
          url-template: https://github.com/CastXML/CastXML/archive/v$version.tar.gz
    cleanup:
      - /lib/cmake

  - name: SWIG
    config-opts:
      - --without-pcre
      - --disable-ccache
      - --without-tcl
      - --without-tcl
      - --without-perl5
      - --without-octave
      - --without-scilab
      - --without-java
      - --without-ruby
    sources:
      - type: archive
        url: https://sourceforge.net/projects/swig/files/swig/swig-4.0.2/swig-4.0.2.tar.gz
        sha256: d53be9730d8d58a16bf0cbd1f8ac0c0c3e1090573168bfa151b01eb47fa906fc
        x-checker-data:
          type: anitya
          project-id: 4919
          stable-only: true
          url-template: https://sourceforge.net/projects/swig/files/swig/swig-$version/swig-$version.tar.gz
    cleanup:
      - /share

  - name: gdcm
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DGDCM_BUILD_APPLICATIONS=OFF
      - -DGDCM_BUILD_SHARED_LIBS=ON
      - -DCMAKE_BUILD_TYPE=Release
      - -DGDCM_WRAP_PYTHON=ON
      - -DPYTHON_EXECUTABLE=/usr/bin/python3
      - -DGDCM_INSTALL_PYTHONMODULE_DIR=/app/lib/python3.8/site-packages/
      - -DGDCM_USE_VTK=OFF
      - -DGDCM_BUILD_DOCBOOK_MANPAGES:BOOL=OFF
    sources:
      - type: archive
        url: https://github.com/malaterre/GDCM/archive/v3.0.10.tar.gz
        sha256: a3fd3579ca0bb4a2a41ee18770e7303b22fd5460c3a2000e51ff0be6799e1d85
        x-checker-data:
          type: anitya
          project-id: 883
          stable-only: true
          url-template: https://github.com/malaterre/GDCM/archive/v$version.tar.gz
    cleanup:
      - /bin

  - name: Eigen3
    buildsystem: cmake-ninja
    builddir: true
    sources:
      - type: archive
        url: https://gitlab.com/libeigen/eigen/-/archive/3.4.0/eigen-3.4.0.tar.bz2
        sha256: b4c198460eba6f28d34894e3a5710998818515104d6e74e5cc331ce31e46e626
        x-checker-data:
          type: anitya
          project-id: 13751
          stable-only: true
          url-template: https://gitlab.com/libeigen/eigen/-/archive/$version/eigen-$version.tar.bz2
    cleanup:
      - '*'

  - name: ITK
    buildsystem: cmake
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE:STRING=Release
      - -DITK_LEGACY_REMOVE:BOOL=ON
      - -DITK_LEGACY_SILENT:BOOL=ON
      - -DModule_ITKBridgeNumPy:BOOL=ON
      - -DBUILD_TESTING:BOOL=OFF
      - -DITK_WRAP_unsigned_short:BOOL=ON
      - -DITK_WRAP_rgb_unsigned_char:BOOL=OFF
      - -DITK_WRAP_rgba_unsigned_char:BOOL=OFF
      - -DITK_BUILD_DEFAULT_MODULES:BOOL=OFF
      - -DITKGroup_Core:BOOL=ON
      - -DITKGroup_Filtering:BOOL=ON
      - -DITKGroup_Segmentation:BOOL=ON
      - -DITKGroup_Nonunit:BOOL=ON
      - -DPython_ADDITIONAL_VERSIONS:STRING=3
      - -DITK_WRAP_PYTHON:BOOL=ON
      - -DBUILD_EXAMPLES:BOOL=OFF
      - -DBUILD_SHARED_LIBS:BOOL=ON
      - -DITK_USE_SYSTEM_LIBRARIES:BOOL=ON
      - -DITK_USE_SYSTEM_CASTXML:BOOL=ON
      - -DITK_USE_SYSTEM_GDCM:BOOL=ON
      - -DITK_USE_SYSTEM_SWIG:BOOL=ON
      - -DITK_USE_SYSTEM_VXL:BOOL=OFF
      - -DITK_FORBID_DOWNLOADS=ON
    sources:
      - type: archive
        url: https://github.com/InsightSoftwareConsortium/ITK/archive/refs/tags/v5.2.1.tar.gz
        sha256: 6022b2b64624b8bcec3333fe48d5f74ff6ebceb3bdf98258ba7d7fbbc76b99ab
        x-checker-data:
          type: anitya
          project-id: 223473
          stable-only: true
          url-template: https://github.com/InsightSoftwareConsortium/ITK/archive/refs/tags/v$version.tar.gz

  - name: alizams
    buildsystem: cmake
    config-opts:
      - -DCMAKE_BUILD_TYPE:STRING=Release
      - -DCMAKE_INSTALL_PREFIX=/app
      - -DCMAKE_INSTALL_LIBDIR=/app/lib
      - -DALIZA_QT_VERSION:STRING=5
    sources:
      - type: archive
        only-arches: [x86_64]
        url: https://github.com/AlizaMedicalImaging/AlizaMS/archive/v1.7.2/AlizaMS-1.7.2.tar.gz
        sha256: b9049f4c0b2ca4fad2ad161439284d232941c099f64b10bb9c71254188602d0d
      - type: file
        path: com.alizadicomviewer.AlizaMS.metainfo.xml
    post-install:
      - desktop-file-edit --set-icon $FLATPAK_ID --set-key Exec --set-value
        'alizams' /app/share/applications/alizams.desktop
      - install -Dm644 com.alizadicomviewer.AlizaMS.metainfo.xml -t /app/share/appdata

